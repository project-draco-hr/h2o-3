{
  Response res=checkArguments(parms);
  if (res == null) {
    long time=System.currentTimeMillis();
    try {
      res=serve();
    }
 catch (    Throwable t) {
      res=new Response(t);
    }
    res._timeStart=time;
  }
switch (type) {
case html:
    RString html=new RString(htmlTemplate());
  html.replace("CONTENTS",res.toString());
return server.new Response(NanoHTTPD.HTTP_OK,NanoHTTPD.MIME_HTML,html.toString());
case json:
{
String debug=new String(res.req().writeJSON(new AutoBuffer()).buf());
System.out.println("JSON return for " + res.req().getClass() + " : "+ debug);
return server.new Response(NanoHTTPD.HTTP_OK,NanoHTTPD.MIME_JSON,debug);
}
case xml:
case java:
throw H2O.unimpl();
default :
throw H2O.unimpl();
}
}
