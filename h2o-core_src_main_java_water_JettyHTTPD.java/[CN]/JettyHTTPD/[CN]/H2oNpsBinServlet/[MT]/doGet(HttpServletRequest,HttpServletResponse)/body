{
  String uri=getDecodedUri(request);
  try {
    Pattern p=Pattern.compile(".*/NodePersistentStorage.bin/([^/]+)/([^/]+)");
    Matcher m=p.matcher(uri);
    boolean b=m.matches();
    if (!b) {
      response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
      response.getWriter().write("Improperly formatted URI");
      return;
    }
    String categoryName=m.group(1);
    String keyName=m.group(2);
    NodePersistentStorage nps=H2O.getNPS();
    AtomicLong length=new AtomicLong();
    InputStream is=nps.get(categoryName,keyName,length);
    response.setContentType("application/octet-stream");
    response.setContentLengthLong(length.get());
    response.addHeader("Content-Disposition","attachment; filename=" + keyName + ".flow");
    response.setStatus(HttpServletResponse.SC_OK);
    OutputStream os=response.getOutputStream();
    water.util.FileUtils.copyStream(is,os,2048);
  }
 catch (  Exception e) {
    sendErrorResponse(response,e,uri);
  }
}
