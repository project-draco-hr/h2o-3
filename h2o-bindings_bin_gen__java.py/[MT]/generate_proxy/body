def generate_proxy(classname, endpoints, schemas_map):
    '\n    Retrofit interfaces look like this:\n        public interface GitHubService {\n            @GET("/users/{user}/repos")\n            Call<List<Repo>> listRepos(@Path("user") String user);\n        }\n      :param classname: name of the class\n      :param endpoints: list of endpoints served by this class\n      :param schemas_map: dictionary schema_name => schema_info\n    '
    var_pattern = re.compile('\\(\\?<(\\w+)>.*?\\)')
    methods = set()
    helper_class = []
    found_key_array_parameter = False
    yield '/**'
    yield ' * This file is auto-generated by h2o-3/h2o-bindings/bin/gen_java.py'
    yield ' * Copyright 2016 H2O.ai;  Apache License Version 2.0 (see LICENSE for details)'
    yield ' */'
    yield 'package water.bindings.proxies.retrofit;'
    yield ''
    yield 'import water.bindings.pojos.*;'
    yield 'import retrofit2.*;'
    yield 'import retrofit2.http.*;'
    yield 'import java.util.Map;'
    yield ''
    yield (('public interface ' + classname) + ' {')
    for e in endpoints:
        path = e['url_pattern']
        path_params = e['path_params']
        summary = e['summary']
        http_method = e['http_method']
        input_schema_name = e['input_schema']
        output_schema_name = e['output_schema']
        method = e['handler_method']
        input_schema = schemas_map[input_schema_name]
        is_post = (http_method == 'POST')
        if (path == '/3/ModelMetrics/frames/(?<frame>.*)/models/(?<model>.*)'):
            continue
        if (path == '/3/ModelMetrics/frames/(?<frame>.*)'):
            continue
        assert ('\\' not in path), ('Your path contains backslashes. Seriously? ' + path)

        def translator(m):
            name = path_params[translator.i]
            assert (name.replace('_', '') == m.group(1)), ('Unexpected name %s for param <%s>' % (name, m.group(1)))
            translator.i += 1
            return ('{%s}' % name)
        translator.i = 0
        retrofit_path = var_pattern.sub(translator, path)
        algo = None
        if ((classname, method) in [('Grid', 'train'), ('ModelBuilders', 'train'), ('ModelBuilders', 'validate_parameters')]):
            pieces = path.split('/')
            assert (len(pieces) >= 4), ('Expected to see algo name in the path: ' + path)
            algo = pieces[3]
            method = ((method + '_') + algo)
            for field in input_schema['fields']:
                if (field['name'] == 'parameters'):
                    input_schema_name = field['schema_name']
                    input_schema = schemas_map[input_schema_name]
                    break
        param_strs = []
        param_infos = []
        for parm in path_params:
            fields = [field for field in input_schema['fields'] if (field['name'] == parm)]
            assert (len(fields) == 1), ('Failed to find parameter: %s for endpoint: %r' % (parm, e))
            field = fields[0]
            if (field['direction'] == 'OUTPUT'):
                continue
            ptype = translate_type(field['type'], field['schema_name'])
            if ptype.endswith('KeyV3'):
                ptype = 'String'
            if ptype.endswith('KeyV3[]'):
                ptype = 'String[]'
            if (ptype == 'ColSpecifierV3'):
                ptype = 'String'
            param_strs.append('@Path("{parm}") {ptype} {parm}'.format(**locals()))
        for field in input_schema['fields']:
            if (not is_post):
                break
            if (field['direction'] == 'OUTPUT'):
                continue
            if (field['name'] in path_params):
                continue
            parm = field['name']
            ptype = translate_type(field['type'], field['schema_name'])
            param_infos.append((parm, ptype))
            if ptype.endswith('KeyV3'):
                ptype = 'String'
            if ptype.endswith('KeyV3[]'):
                ptype = 'String[]'
            if (ptype == 'ColSpecifierV3'):
                ptype = 'String'
            param_strs.append('@Field("{parm}") {ptype} {parm}'.format(**locals()))
        method_with_args = (method, tuple(param_strs))
        assert (method_with_args not in methods), ((('ERROR: duplicate method in classname ' + classname) + ': ') + method)
        methods.add(method_with_args)
        yield u'  /** '
        yield bi.wrap(summary, indent='   * ')
        yield u'   */'
        yield (u'  @FormUrlEncoded' if is_post else None)
        yield (u'  @%(method)s("%(path)s")' % {'method': http_method, 'path': retrofit_path, })
        if (len(param_strs) <= 1):
            args = (param_strs[0] if param_strs else '')
            yield '  Call<{schema}> {method}({args});'.format(schema=output_schema_name, method=method, args=args)
        else:
            yield '  Call<{schema}> {method}('.format(schema=output_schema_name, method=method)
            for arg in param_strs:
                yield (('    ' + arg) + ('' if (arg == param_strs[(-1)]) else ','))
            yield '  );'
        yield ''
        if algo:
            helper_class.append('    /**')
            helper_class.append(bi.wrap(summary, indent='     * '))
            helper_class.append('     */')
            helper_class.append('    public static Call<{oschema}> {method}({outer_class} z, {ischema} p) {{'.format(ischema=input_schema_name, oschema=output_schema_name, method=method, outer_class=classname))
            helper_class.append('      return z.{method}('.format(method=method))
            for (pname, ptype) in param_infos:
                if ptype.endswith('KeyV3'):
                    s = '(p.{parm} == null? null : p.{parm}.name)'.format(parm=pname)
                elif ptype.endswith('KeyV3[]'):
                    found_key_array_parameter = True
                    s = '(p.{parm} == null? null : key_array_to_string_array(p.{parm}))'.format(parm=pname)
                elif ptype.startswith('ColSpecifier'):
                    s = '(p.{parm} == null? null : p.{parm}.column_name)'.format(parm=pname)
                else:
                    s = ('p.' + pname)
                if (pname != param_infos[(-1)][0]):
                    s += ','
                helper_class.append(('        ' + s))
            helper_class.append('      );')
            helper_class.append('    }')
            helper_class.append('')
    if helper_class:
        yield ''
        yield '  public static class Helper {'
        for line in helper_class:
            yield line
        if found_key_array_parameter:
            yield '    /**'
            yield '     * Return an array of Strings for an array of keys.'
            yield '     */'
            yield '    public static String[] key_array_to_string_array(KeyV3[] keys) {'
            yield '      if (keys == null) return null;'
            yield '      String[] ids = new String[keys.length];'
            yield '      int i = 0;'
            yield '      for (KeyV3 key : keys) ids[i++] = key.name;'
            yield '      return ids;'
            yield '    }'
        yield '  }'
        yield ''
    yield '}'
