def csv_dict_writer(f, fieldnames, **kwargs):
    import csv
    if (u'delimiter' in kwargs):
        delim = kwargs.pop(u'delimiter')
        if PY2:
            delim = str(delim).encode(u'utf-8')
        if PY3:
            delim = str(delim)
        kwargs[u'delimiter'] = delim
    return csv.DictWriter(f, fieldnames, **kwargs)
