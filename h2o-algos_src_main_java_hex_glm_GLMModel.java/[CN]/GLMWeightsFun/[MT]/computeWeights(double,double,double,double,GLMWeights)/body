{
  x.mu=linkInv(eta + off);
  double var=Math.max(1e-6,variance(x.mu));
  double d=linkDeriv(x.mu);
  x.w=w / (var * d * d);
  x.z=eta + (y - x.mu) * d;
  if (_family == Family.binomial && _link == Link.logit) {
    x.l=w * Math.log(1 + Math.exp((eta - 2 * y * eta)));
    x.dev=2 * x.l;
  }
 else {
    x.l=w * likelihood(y,x.mu);
    x.dev=w * deviance(y,x.mu);
  }
  return x;
}
