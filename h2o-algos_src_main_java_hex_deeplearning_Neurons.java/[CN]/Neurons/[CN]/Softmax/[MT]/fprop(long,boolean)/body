{
  gemv(_a,_w,_previous._a,_b,null);
  final double max=ArrayUtils.maxValue(_a.raw());
  double scaling=0;
  final int rows=_a.size();
  for (int row=0; row < rows; row++) {
    _a.set(row,(float)Math.exp(_a.get(row) - max));
    scaling+=_a.get(row);
  }
  for (int row=0; row < rows; row++) {
    _a.raw()[row]/=scaling;
    if (Double.isNaN(_a.get(row))) {
      _minfo.set_unstable();
      throw new RuntimeException("Numerical instability, predicted NaN.");
    }
  }
}
