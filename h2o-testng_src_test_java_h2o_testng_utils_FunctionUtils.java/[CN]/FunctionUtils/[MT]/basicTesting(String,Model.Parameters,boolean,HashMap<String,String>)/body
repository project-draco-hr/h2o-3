{
  boolean isTestSuccessfully=false;
  Frame trainFrame=null;
  Frame score=null;
  Model.Output modelOutput=null;
  ModelMetrics modelMetrics=null;
  DRF drfJob=null;
  DRFModel drfModel=null;
  Key modelKey=Key.make("model");
  GLM glmJob=null;
  GLMModel glmModel=null;
  HashMap<String,Double> coef=null;
  GBM gbmJob=null;
  GBMModel gbmModel=null;
  DeepLearning dlJob=null;
  DeepLearningModel dlModel=null;
  trainFrame=parameter._train.get();
  try {
    Scope.enter();
switch (algorithm) {
case FunctionUtils.drf:
      System.out.println("Build model");
    drfJob=new DRF((DRFModel.DRFParameters)parameter);
  System.out.println("Train model:");
drfModel=drfJob.trainModel().get();
System.out.println("Predict testcase");
score=drfModel.score(trainFrame);
modelOutput=drfModel._output;
break;
case FunctionUtils.glm:
System.out.println("Build model");
glmJob=new GLM(modelKey,"basic glm test",(GLMParameters)parameter);
System.out.println("Train model");
glmModel=glmJob.trainModel().get();
coef=glmModel.coefficients();
System.out.println("Predict testcase ");
score=glmModel.score(trainFrame);
modelOutput=glmModel._output;
break;
case FunctionUtils.gbm:
System.out.println("Build model ");
gbmJob=new GBM((GBMParameters)parameter);
System.out.println("Train model");
gbmModel=gbmJob.trainModel().get();
System.out.println("Predict testcase ");
score=gbmModel.score(trainFrame);
modelOutput=gbmModel._output;
break;
case FunctionUtils.dl:
System.out.println("Build model ");
dlJob=new DeepLearning((DeepLearningParameters)parameter);
System.out.println("Train model");
dlModel=dlJob.trainModel().get();
System.out.println("Predict testcase ");
score=dlModel.score(trainFrame);
modelOutput=dlModel._output;
break;
}
if (modelOutput.isClassifier() && !Param.parseBoolean(rawInput.get(CommonHeaders.classification))) {
Assert.fail("This is regression testcase");
}
 else if (!modelOutput.isClassifier() && Param.parseBoolean(rawInput.get(CommonHeaders.classification))) {
Assert.fail("This is classification testcase");
}
isTestSuccessfully=true;
if (!isNegativeTestcase) {
System.out.println("Testcase passed.");
modelMetrics=modelOutput._training_metrics;
System.out.println("MSE: " + modelMetrics._MSE);
if (modelMetrics.auc() != null) {
System.out.println("AUC: " + modelMetrics.auc()._auc);
MySQL.save(String.valueOf(modelMetrics._MSE),String.valueOf(modelMetrics.auc()._auc),rawInput);
}
 else {
System.out.println("AUC: NA");
MySQL.save(String.valueOf(modelMetrics._MSE),null,rawInput);
}
}
}
 catch (Exception ex) {
handleTestcaseFailed(isNegativeTestcase,ex,rawInput,algorithm);
}
catch (AssertionError ae) {
handleTestcaseFailed(isNegativeTestcase,ae,rawInput,algorithm);
}
 finally {
if (drfJob != null) {
drfJob.remove();
}
if (drfModel != null) {
drfModel.delete();
}
if (glmJob != null) {
glmJob.remove();
}
if (glmModel != null) {
glmModel.delete();
}
if (gbmJob != null) {
gbmJob.remove();
}
if (gbmModel != null) {
gbmModel.delete();
}
if (dlJob != null) {
dlJob.remove();
}
if (dlModel != null) {
dlModel.delete();
}
if (score != null) {
score.remove();
score.delete();
}
Scope.exit();
}
if (isNegativeTestcase && isTestSuccessfully) {
System.out.println("It is negative testcase");
Assert.fail("It is negative testcase");
}
}
