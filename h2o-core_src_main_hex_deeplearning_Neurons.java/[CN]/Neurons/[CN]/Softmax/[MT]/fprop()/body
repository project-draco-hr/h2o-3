{
  gemv((DenseVector)_a,(DenseRowMatrix)_w,(DenseVector)_previous._a,_b,null);
  final float max=ArrayUtils.maxValue(_a.raw());
  float scale=0f;
  final float rows=_a.size();
  for (int row=0; row < rows; row++) {
    _a.set(row,(float)Math.exp(_a.get(row) - max));
    scale+=_a.get(row);
  }
  for (int row=0; row < rows; row++) {
    if (Float.isNaN(_a.get(row)))     throw new RuntimeException("Numerical instability, predicted NaN.");
    _a.raw()[row]/=scale;
  }
}
