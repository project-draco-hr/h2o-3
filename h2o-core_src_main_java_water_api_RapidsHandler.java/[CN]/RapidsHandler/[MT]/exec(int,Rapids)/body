{
  if (rapids == null)   return null;
  Throwable e=null;
  Env env=null;
  try {
    if (rapids._funs != null) {
      for (      String f : rapids._funs) {
        water.rapids.Exec.new_func(f);
      }
    }
    if (rapids._ast.equals("") || rapids._ast == null)     return schema(version).fillFromImpl(rapids);
    env=water.rapids.Exec.exec(rapids._ast);
    StringBuilder sb=env._sb;
    if (sb.length() != 0)     sb.append("\n");
    if (env.isAry()) {
      Frame fr=env.pop0Ary();
      rapids._key=fr._key;
      rapids._num_rows=fr.numRows();
      rapids._num_cols=fr.numCols();
      rapids._col_names=fr.names();
      rapids._string=null;
    }
 else     if (env.isNum()) {
      rapids._scalar=env.popDbl();
      sb.append(Double.toString(rapids._scalar));
      rapids._string=null;
    }
 else     if (env.isStr()) {
      rapids._string=env.popStr();
      sb.append(rapids._string);
    }
    rapids._result=sb.toString();
    return schema(version).fillFromImpl(rapids);
  }
 catch (  IllegalArgumentException pe) {
    e=pe;
  }
catch (  Throwable e2) {
    Log.err(e=e2);
  }
 finally {
    if (e != null)     e.printStackTrace();
    if (e != null)     rapids._error=e.getMessage() == null ? e.toString() : e.getMessage();
    if (e != null && e instanceof ArrayIndexOutOfBoundsException)     rapids._error=e.toString();
    if (env != null) {
      try {
        env.remove_and_unlock();
      }
 catch (      Exception xe) {
        Log.err("env.remove_and_unlock() failed",xe);
      }
    }
  }
  return schema(version).fillFromImpl(rapids);
}
