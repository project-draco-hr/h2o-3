{
  Log.info("NPS put content category(" + categoryName + ") keyName("+ keyName+ ")");
  validateCategoryName(categoryName);
  validateKeyName(keyName);
  PersistManager pm=H2O.getPM();
  if (!pm.exists(NPS_DIR)) {
    boolean success=pm.mkdirs(NPS_DIR);
    if (!success) {
      throw new RuntimeException("Could not make NodePersistentStorage directory (" + NPS_DIR + ")");
    }
  }
  if (!pm.exists(NPS_DIR)) {
    throw new RuntimeException("NodePersistentStorage directory does not exist (" + NPS_DIR + ")");
  }
  String tmpd=NPS_DIR + NPS_SEPARATOR + "_tmp";
  if (!pm.exists(tmpd)) {
    boolean success=pm.mkdirs(tmpd);
    if (!success) {
      throw new RuntimeException("Could not make NodePersistentStorage category directory (" + tmpd + ")");
    }
  }
  if (!pm.exists(tmpd)) {
    throw new RuntimeException("NodePersistentStorage category directory does not exist (" + tmpd + ")");
  }
  String d2=NPS_DIR + NPS_SEPARATOR + categoryName;
  if (!pm.exists(d2)) {
    boolean success=pm.mkdirs(d2);
    if (!success) {
      throw new RuntimeException("Could not make NodePersistentStorage category directory (" + d2 + ")");
    }
  }
  if (!pm.exists(d2)) {
    throw new RuntimeException("NodePersistentStorage category directory does not exist (" + d2 + ")");
  }
  String tmpf=tmpd + NPS_SEPARATOR + keyName;
  boolean overwrite=true;
  OutputStream os=null;
  try {
    os=pm.create(tmpf,overwrite);
    copyStream(is,os);
  }
  finally {
    if (os != null) {
      try {
        os.close();
      }
 catch (      Exception e) {
        Log.err(e);
      }
    }
  }
  String realf=d2 + NPS_SEPARATOR + keyName;
  boolean success=pm.rename(tmpf,realf);
  if (!success) {
    throw new RuntimeException("NodePersistentStorage move failed (" + tmpf + " -> "+ realf+ ")");
  }
  if (!pm.exists(realf)) {
    throw new RuntimeException("NodePersistentStorage file does not exist (" + realf + ")");
  }
  Log.info("Put succeeded");
}
