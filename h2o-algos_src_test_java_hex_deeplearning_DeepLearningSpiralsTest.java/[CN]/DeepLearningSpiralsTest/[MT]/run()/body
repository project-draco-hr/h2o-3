{
  Scope.enter();
  NFSFileVec nfs=NFSFileVec.make(find_test_file("smalldata/junit/two_spiral.csv"));
  Frame frame=ParseDataset.parse(Key.make(),nfs._key);
  Log.info(frame);
  int resp=frame.names().length - 1;
  for (  boolean sparse : new boolean[]{true,false}) {
    for (    boolean col_major : new boolean[]{false}) {
      if (!sparse && col_major)       continue;
      Key model_id=Key.make();
{
        DeepLearningParameters p=new DeepLearningParameters();
        p._seed=0xbabefff;
        p._epochs=600;
        p._hidden=new int[]{100};
        p._sparse=sparse;
        p._col_major=col_major;
        p._elastic_averaging=false;
        p._activation=DeepLearningParameters.Activation.Tanh;
        p._max_w2=Float.POSITIVE_INFINITY;
        p._l1=0;
        p._l2=0;
        p._initial_weight_distribution=DeepLearningParameters.InitialWeightDistribution.Normal;
        p._initial_weight_scale=2.5;
        p._loss=DeepLearningParameters.Loss.CrossEntropy;
        p._train=frame._key;
        p._response_column=frame.names()[resp];
        Scope.track(frame.replace(resp,frame.vecs()[resp].toCategoricalVec()));
        DKV.put(frame);
        p._valid=null;
        p._score_interval=2;
        p._train_samples_per_iteration=0;
        p._fast_mode=true;
        p._ignore_const_cols=true;
        p._nesterov_accelerated_gradient=true;
        p._score_training_samples=1000;
        p._score_validation_samples=10000;
        p._shuffle_training_data=false;
        p._force_load_balance=false;
        p._replicate_training_data=false;
        p._model_id=model_id;
        p._adaptive_rate=true;
        p._reproducible=true;
        p._rho=0.99;
        p._epsilon=5e-3;
        DeepLearning dl=new DeepLearning(p);
        try {
          dl.trainModel().get();
        }
 catch (        Throwable t) {
          t.printStackTrace();
          throw new RuntimeException(t);
        }
 finally {
          dl.remove();
        }
      }
{
        DeepLearningModel mymodel=DKV.getGet(model_id);
        Frame pred=mymodel.score(frame);
        ModelMetricsBinomial mm=ModelMetricsBinomial.getFromDKV(mymodel,frame);
        double error=mm._auc.defaultErr();
        Log.info("Error: " + error);
        if (error > 0) {
          Assert.fail("Classification error is not 0, but " + error + ".");
        }
        Assert.assertTrue(mymodel.testJavaScoring(frame,pred,1e-6));
        pred.delete();
        mymodel.delete();
      }
    }
  }
  frame.delete();
  Scope.exit();
}
