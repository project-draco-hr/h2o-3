{
  Thread.currentThread().setPriority(Thread.MAX_PRIORITY - 1);
  int version=parseVersion(uri);
  int idx=version >> 16;
  version&=0xFFFF;
  String uripath=uri.substring(idx);
  RequestType type=RequestType.requestType(uripath);
  String path=type.requestName(uripath);
  maybeLogRequest(path,method,parms);
  try {
    Method meth=lookup(method,path);
    if (meth == null)     return getResource(uri);
    return wrap(HTTP_OK,handle(type,meth,version,parms),type);
  }
 catch (  IllegalArgumentException e) {
    return wrap(HTTP_BADREQUEST,new HTTP404V1(e.getMessage(),uri),type);
  }
catch (  Exception e) {
    return wrap("unimplemented".equals(e.getMessage()) ? HTTP_NOTIMPLEMENTED : HTTP_INTERNALERROR,new HTTP500V1(e),type);
  }
}
